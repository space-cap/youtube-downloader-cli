# 개발 로드맵

## 📋 개요

YouTube Downloader 웹 인터페이스 개발을 위한 6일 일정의 상세 로드맵입니다.

**총 개발 기간**: 6일  
**시작일**: TBD  
**완료 목표일**: TBD

---

## 📊 전체 진행 상황

```
Phase 1: 백엔드 API 개발        [Day 1-2]  ░░░░░░░░░░ 0%
Phase 2: WebSocket 구현         [Day 3]    ░░░░░░░░░░ 0%
Phase 3: 프론트엔드 개발        [Day 4-5]  ░░░░░░░░░░ 0%
Phase 4: 통합 및 배포           [Day 6]    ░░░░░░░░░░ 0%
```

---

## 🗓️ Day 1: 백엔드 기초 설정 및 동영상 정보 API

**목표**: FastAPI 프로젝트 설정 및 동영상 정보 조회 API 구현

### 오전 (4시간)

#### 1. 프로젝트 환경 설정 (1.5시간)
- [ ] FastAPI 의존성 추가
  ```bash
  uv pip install fastapi uvicorn[standard] python-multipart websockets aiofiles
  ```
- [ ] 프로젝트 구조 생성
  ```
  src/youtube_downloader/web/
  ├── __init__.py
  ├── app.py          # FastAPI 애플리케이션
  ├── api.py          # API 라우터
  ├── websocket.py    # WebSocket 핸들러
  ├── models.py       # Pydantic 모델
  └── static/         # 정적 파일
      ├── index.html
      ├── style.css
      └── app.js
  ```
- [ ] 기본 FastAPI 앱 생성 (`app.py`)
- [ ] CORS 설정
- [ ] 정적 파일 서빙 설정

**체크포인트**: `uvicorn youtube_downloader.web.app:app --reload` 실행 시 서버 정상 작동

#### 2. Pydantic 모델 정의 (1시간)
- [ ] `VideoInfoRequest` 모델
- [ ] `VideoInfoResponse` 모델
- [ ] `DownloadRequest` 모델
- [ ] `DownloadResponse` 모델
- [ ] `ErrorResponse` 모델

**파일**: `src/youtube_downloader/web/models.py`

#### 3. 기본 라우팅 구조 (1.5시간)
- [ ] API 라우터 생성 (`api.py`)
- [ ] Health check 엔드포인트 (`GET /health`)
- [ ] API 버전 정보 (`GET /api/v1/version`)
- [ ] Swagger UI 확인 (`/docs`)

**체크포인트**: Swagger UI에서 엔드포인트 확인 가능

### 오후 (4시간)

#### 4. 동영상 정보 조회 API 구현 (3시간)
- [ ] `GET /api/v1/video/info` 엔드포인트 생성
- [ ] 기존 `downloader.py` 모듈 통합
- [ ] URL 유효성 검사
- [ ] 동영상 정보 추출 로직
- [ ] 포맷 정보 파싱
- [ ] 에러 핸들링

**파일**: `src/youtube_downloader/web/api.py`

**테스트 방법**:
```bash
curl "http://localhost:8000/api/v1/video/info?url=https://www.youtube.com/watch?v=dQw4w9WgXcQ"
```

#### 5. 에러 처리 및 로깅 (1시간)
- [ ] 커스텀 예외 클래스 생성
- [ ] 전역 에러 핸들러 설정
- [ ] 로깅 설정 (파일 + 콘솔)
- [ ] 에러 응답 표준화

**체크포인트**: 잘못된 URL 입력 시 적절한 에러 응답 반환

### 마무리
- [ ] 코드 리뷰 및 리팩토링
- [ ] 주석 추가
- [ ] Day 1 작업 커밋

---

## 🗓️ Day 2: 다운로드 API 구현

**목표**: 다운로드 시작, 상태 조회, 파일 다운로드 API 구현

### 오전 (4시간)

#### 1. 작업 관리 시스템 구현 (2시간)
- [ ] Task ID 생성 로직 (UUID)
- [ ] 작업 상태 관리 (in-memory dict)
  - pending, downloading, processing, completed, failed
- [ ] 작업 정보 저장 구조
  ```python
  {
    "task_id": str,
    "status": str,
    "progress": dict,
    "video_info": dict,
    "file_path": str,
    "created_at": datetime,
    "updated_at": datetime
  }
  ```
- [ ] 작업 조회 헬퍼 함수

**파일**: `src/youtube_downloader/web/tasks.py` (신규)

#### 2. 다운로드 시작 API (2시간)
- [ ] `POST /api/v1/download` 엔드포인트
- [ ] 요청 유효성 검사
- [ ] 백그라운드 작업 생성
- [ ] Task ID 반환
- [ ] Rate limiting 구현 (선택사항)

**체크포인트**: API 호출 시 task_id 반환

### 오후 (4시간)

#### 3. 백그라운드 다운로드 작업 (3시간)
- [ ] `BackgroundTasks` 사용
- [ ] 기존 `Downloader` 클래스 통합
- [ ] 진행률 콜백 구현
- [ ] 작업 상태 업데이트
- [ ] 임시 파일 저장 경로 설정
- [ ] 다운로드 완료 후 파일 이동

**파일**: `src/youtube_downloader/web/tasks.py`

#### 4. 상태 조회 및 파일 다운로드 API (1시간)
- [ ] `GET /api/v1/download/{task_id}/status` 구현
- [ ] `GET /api/v1/download/{task_id}/file` 구현
- [ ] `FileResponse` 사용하여 파일 스트리밍
- [ ] Content-Disposition 헤더 설정

**테스트 방법**:
```bash
# 다운로드 시작
curl -X POST http://localhost:8000/api/v1/download \
  -H "Content-Type: application/json" \
  -d '{"url":"https://youtube.com/...", "options":{"quality":"720p"}}'

# 상태 조회
curl http://localhost:8000/api/v1/download/{task_id}/status

# 파일 다운로드
curl -O http://localhost:8000/api/v1/download/{task_id}/file
```

### 마무리
- [ ] 전체 다운로드 플로우 테스트
- [ ] 메모리 누수 확인
- [ ] Day 2 작업 커밋

---

## 🗓️ Day 3: WebSocket 및 실시간 진행률

**목표**: WebSocket 연결 및 실시간 진행률 업데이트 구현

### 오전 (4시간)

#### 1. WebSocket 기본 설정 (1.5시간)
- [ ] WebSocket 엔드포인트 생성
  ```python
  @app.websocket("/ws/download/{task_id}")
  ```
- [ ] 연결 관리 클래스
  ```python
  class ConnectionManager:
      def __init__(self):
          self.active_connections: Dict[str, WebSocket] = {}
  ```
- [ ] 연결/해제 핸들러
- [ ] 메시지 브로드캐스트 함수

**파일**: `src/youtube_downloader/web/websocket.py`

#### 2. 진행률 업데이트 통합 (2.5시간)
- [ ] 다운로드 콜백에서 WebSocket 메시지 전송
- [ ] 진행률 메시지 포맷 (`type: "progress"`)
- [ ] 상태 변경 메시지 (`type: "status"`)
- [ ] 완료 메시지 (`type: "complete"`)
- [ ] 에러 메시지 (`type: "error"`)

**체크포인트**: WebSocket 클라이언트로 실시간 메시지 수신 확인

### 오후 (4시간)

#### 3. WebSocket 테스트 클라이언트 (1시간)
- [ ] 간단한 HTML 테스트 페이지 작성
- [ ] JavaScript WebSocket 연결 코드
- [ ] 메시지 수신 및 콘솔 출력
- [ ] 연결 상태 표시

**파일**: `src/youtube_downloader/web/static/test_ws.html`

#### 4. 작업 취소 기능 (1.5시간)
- [ ] `DELETE /api/v1/download/{task_id}` 구현
- [ ] 다운로드 프로세스 중단 로직
- [ ] 임시 파일 정리
- [ ] 취소 메시지 WebSocket 전송

#### 5. 자동 정리 시스템 (1.5시간)
- [ ] 완료된 작업 자동 삭제 (1시간 후)
- [ ] 스케줄러 설정 (`APScheduler` 또는 `asyncio`)
- [ ] 임시 파일 정리 로직
- [ ] 메모리 정리

**파일**: `src/youtube_downloader/web/cleanup.py` (신규)

### 마무리
- [ ] WebSocket 연결 안정성 테스트
- [ ] 동시 다운로드 테스트 (5개)
- [ ] Day 3 작업 커밋

---

## 🗓️ Day 4: 프론트엔드 UI 구현

**목표**: HTML 구조 및 CSS 스타일링 완성

### 오전 (4시간)

#### 1. HTML 구조 작성 (2시간)
- [ ] 기본 HTML 템플릿
- [ ] Header 컴포넌트
- [ ] Hero Section
- [ ] Download Form
  - URL 입력 필드
  - 화질 선택 드롭다운
  - 오디오 품질 선택
  - 체크박스 옵션
  - 다운로드 버튼
- [ ] Video Preview 영역
- [ ] Progress Section
- [ ] Success/Error 메시지 영역
- [ ] Footer

**파일**: `src/youtube_downloader/web/static/index.html`

#### 2. CSS 변수 및 기본 스타일 (2시간)
- [ ] CSS 변수 정의 (색상, 폰트, 간격)
- [ ] 리셋 스타일
- [ ] 타이포그래피 설정
- [ ] 레이아웃 그리드
- [ ] 컨테이너 스타일

**파일**: `src/youtube_downloader/web/static/style.css`

**체크포인트**: 브라우저에서 기본 레이아웃 확인

### 오후 (4시간)

#### 3. 컴포넌트 스타일링 (3시간)
- [ ] Header 스타일
- [ ] Input 필드 스타일
- [ ] Select 드롭다운 스타일
- [ ] Checkbox 스타일
- [ ] Button 스타일 (primary, secondary)
- [ ] Progress Bar 스타일
- [ ] Video Preview Card 스타일
- [ ] Alert 메시지 스타일 (success, error)

#### 4. 반응형 디자인 (1시간)
- [ ] 모바일 브레이크포인트 (<768px)
- [ ] 태블릿 브레이크포인트 (768px-1024px)
- [ ] 데스크톱 레이아웃 (>1024px)
- [ ] 터치 친화적 버튼 크기

**테스트**: 다양한 화면 크기에서 레이아웃 확인

### 마무리
- [ ] 크로스 브라우저 테스트
- [ ] 디자인 QA
- [ ] Day 4 작업 커밋

---

## 🗓️ Day 5: 프론트엔드 로직 구현

**목표**: JavaScript로 API 통신 및 상태 관리 구현

### 오전 (4시간)

#### 1. 기본 JavaScript 구조 (1시간)
- [ ] 전역 변수 및 상수 정의
- [ ] DOM 요소 참조
- [ ] 이벤트 리스너 등록
- [ ] 초기화 함수

**파일**: `src/youtube_downloader/web/static/app.js`

#### 2. URL 입력 및 유효성 검사 (1.5시간)
- [ ] URL 입력 이벤트 핸들러
- [ ] URL 유효성 검사 함수
- [ ] 에러 메시지 표시
- [ ] 디바운싱 적용 (500ms)

#### 3. 동영상 정보 조회 (1.5시간)
- [ ] `/api/v1/video/info` 호출
- [ ] 로딩 상태 표시
- [ ] 응답 데이터 파싱
- [ ] Video Preview 렌더링
- [ ] 포맷 옵션 동적 생성

**체크포인트**: URL 입력 시 동영상 정보 표시

### 오후 (4시간)

#### 4. 다운로드 시작 및 WebSocket 연결 (2.5시간)
- [ ] 다운로드 버튼 클릭 핸들러
- [ ] `/api/v1/download` POST 요청
- [ ] Task ID 저장
- [ ] WebSocket 연결 생성
- [ ] WebSocket 메시지 핸들러
  - `progress`: 진행률 업데이트
  - `status`: 상태 변경
  - `complete`: 완료 처리
  - `error`: 에러 표시

#### 5. 진행률 표시 및 파일 다운로드 (1.5시간)
- [ ] Progress Bar 업데이트 함수
- [ ] 진행률 텍스트 업데이트
- [ ] 속도 및 ETA 표시
- [ ] 완료 시 다운로드 버튼 표시
- [ ] 파일 다운로드 트리거
- [ ] 취소 버튼 기능

**체크포인트**: 전체 다운로드 플로우 동작 확인

### 마무리
- [ ] 에러 케이스 테스트
- [ ] 사용자 경험 개선
- [ ] Day 5 작업 커밋

---

## 🗓️ Day 6: 통합 테스트 및 배포 준비

**목표**: 전체 시스템 테스트 및 문서화

### 오전 (4시간)

#### 1. 통합 테스트 (2시간)
- [ ] 전체 다운로드 플로우 테스트
  - 동영상 다운로드
  - 오디오 전용 다운로드
  - 다양한 화질 옵션
- [ ] 에러 시나리오 테스트
  - 잘못된 URL
  - 네트워크 오류
  - 서버 오류
- [ ] 동시 다운로드 테스트 (5개)
- [ ] 브라우저 호환성 테스트

#### 2. 성능 최적화 (1시간)
- [ ] 응답 시간 측정
- [ ] 메모리 사용량 확인
- [ ] 불필요한 로깅 제거
- [ ] 프로덕션 설정 적용

#### 3. 다크 모드 구현 (1시간)
- [ ] 테마 토글 버튼
- [ ] 다크 모드 CSS 변수
- [ ] localStorage에 선호도 저장
- [ ] 부드러운 전환 애니메이션

### 오후 (4시간)

#### 4. 문서 작성 (2시간)
- [ ] 배포 가이드 작성
  - 로컬 실행 방법
  - 환경 변수 설정
  - Docker 설정 (선택사항)
- [ ] 사용자 가이드 업데이트
- [ ] API 문서 최종 검토
- [ ] README 업데이트

**파일**: `docs/web/04-배포-가이드.md`

#### 5. 보안 강화 (1시간)
- [ ] Rate limiting 설정
- [ ] CORS 정책 검토
- [ ] 입력 검증 강화
- [ ] 파일 크기 제한 (선택사항)

#### 6. 최종 점검 및 배포 (1시간)
- [ ] 전체 코드 리뷰
- [ ] 린팅 및 포맷팅
- [ ] 테스트 커버리지 확인
- [ ] 프로덕션 빌드
- [ ] 배포 (선택사항)

### 마무리
- [ ] 최종 커밋 및 푸시
- [ ] 릴리스 노트 작성
- [ ] 프로젝트 완료 🎉

---

## 📊 일일 체크리스트

### 매일 시작 전
- [ ] 이전 날 작업 리뷰
- [ ] 오늘 목표 확인
- [ ] 개발 환경 준비

### 매일 종료 전
- [ ] 작업 내용 커밋
- [ ] 진행 상황 업데이트
- [ ] 다음 날 계획 확인
- [ ] 코드 백업

---

## 🚨 주의사항

### 기술적 고려사항
1. **비동기 처리**: FastAPI의 async/await 적극 활용
2. **메모리 관리**: 대용량 파일 다운로드 시 스트리밍 사용
3. **에러 처리**: 모든 예외 상황에 대한 적절한 처리
4. **보안**: 사용자 입력 검증 철저히

### 개발 팁
1. **작은 단위로 커밋**: 기능별로 자주 커밋
2. **테스트 우선**: 각 기능 구현 후 즉시 테스트
3. **문서화**: 복잡한 로직은 주석 추가
4. **코드 리뷰**: 하루 종료 시 자체 리뷰

---

## 📈 진행 상황 추적

### Week 1
| Day | 계획 | 실제 | 완료율 | 비고 |
|-----|------|------|--------|------|
| 1 | 백엔드 기초 | - | 0% | - |
| 2 | 다운로드 API | - | 0% | - |
| 3 | WebSocket | - | 0% | - |
| 4 | 프론트엔드 UI | - | 0% | - |
| 5 | 프론트엔드 로직 | - | 0% | - |
| 6 | 통합 및 배포 | - | 0% | - |

---

## 🎯 마일스톤

- [ ] **M1**: 백엔드 API 완성 (Day 2 종료)
- [ ] **M2**: 실시간 진행률 동작 (Day 3 종료)
- [ ] **M3**: UI 완성 (Day 4 종료)
- [ ] **M4**: 전체 기능 동작 (Day 5 종료)
- [ ] **M5**: 배포 준비 완료 (Day 6 종료)

---

## 📚 참고 자료

### FastAPI
- [공식 문서](https://fastapi.tiangolo.com/)
- [WebSocket 가이드](https://fastapi.tiangolo.com/advanced/websockets/)
- [Background Tasks](https://fastapi.tiangolo.com/tutorial/background-tasks/)

### 프론트엔드
- [Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)
- [WebSocket API](https://developer.mozilla.org/en-US/docs/Web/API/WebSocket)
- [CSS Grid](https://css-tricks.com/snippets/css/complete-guide-grid/)

### 기타
- [yt-dlp 문서](https://github.com/yt-dlp/yt-dlp)
- [기존 CLI 코드](../../src/youtube_downloader/)

---

## 💡 트러블슈팅

### 예상 문제 및 해결책

#### 1. CORS 오류
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"],
)
```

#### 2. WebSocket 연결 끊김
- 주기적인 ping/pong 메시지 전송
- 재연결 로직 구현

#### 3. 대용량 파일 메모리 부족
- 스트리밍 방식으로 파일 전송
- 청크 단위 처리

#### 4. 동시 다운로드 제한
- 세마포어 사용하여 최대 5개 제한
```python
download_semaphore = asyncio.Semaphore(5)
```

---

## ✅ 최종 체크리스트

개발 완료 전 확인사항:

### 기능
- [ ] 동영상 정보 조회 동작
- [ ] 다운로드 시작 동작
- [ ] 실시간 진행률 표시
- [ ] 파일 다운로드 동작
- [ ] 에러 처리 정상 동작
- [ ] 다크 모드 동작

### 품질
- [ ] 모든 API 엔드포인트 테스트 완료
- [ ] 반응형 디자인 확인
- [ ] 브라우저 호환성 확인
- [ ] 성능 테스트 완료
- [ ] 보안 검토 완료

### 문서
- [ ] API 명세서 최신화
- [ ] 배포 가이드 작성
- [ ] README 업데이트
- [ ] 코드 주석 추가

### 배포
- [ ] 환경 변수 설정
- [ ] 프로덕션 설정 적용
- [ ] 로깅 설정 확인
- [ ] 백업 계획 수립
